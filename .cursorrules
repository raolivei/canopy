## Workspace

See `../workspace-config/docs/PROJECT_CONVENTIONS.md` for shared conventions (git workflow, CHANGELOG, Docker/GHCR, K8s, security).

**Ports** (from `../workspace-config/ports/.env.ports`):

- Frontend: `3001`
- API: `8001`
- PostgreSQL: `5433`
- Redis: `6380`

## Commands

```bash
# Development (Docker Compose - recommended)
source ../workspace-config/ports/.env.ports
docker-compose up                    # Start all services
docker-compose up -d                 # Start detached

# Testing
docker-compose exec api pytest       # Run backend tests
cd frontend && npm test              # Run frontend tests

# Database
docker-compose exec api alembic upgrade head           # Run migrations
docker-compose exec api alembic revision --autogenerate -m "desc"  # New migration
docker-compose exec postgres psql -U postgres -d canopy  # PostgreSQL shell

# Linting (run after changes)
cd backend && ruff check . && ruff format .  # Python
cd frontend && npm run lint                   # TypeScript
```

## Workflow

1. Always lint/format after code changes
2. Run tests before committing
3. Update CHANGELOG.md for all changes
4. Never run git commands at workspace root

## Project Overview

Self-hosted personal finance dashboard. Runs on **eldertree** k3s cluster.

```
canopy/
├── backend/           # FastAPI (Python)
│   ├── api/          # API endpoints
│   ├── models/       # Pydantic models
│   ├── app/          # FastAPI app
│   ├── ingest/       # CSV/OFX import
│   └── services/     # Business logic
├── frontend/         # Next.js (TypeScript)
│   ├── components/   # React components
│   ├── pages/        # Next.js pages
│   └── utils/        # Utilities
└── k8s/              # Kubernetes manifests
```

## Code Style

**Python**: See `backend/api/transactions.py` for route patterns, `backend/models/transaction.py` for Pydantic models.

**TypeScript**: See `frontend/components/` for component patterns. Use Tailwind CSS.

## Common Tasks

### Adding API Endpoint

1. Add route in `backend/api/`
2. Add Pydantic model in `backend/models/`
3. Update API docs (auto-generated)

### Adding CSV Import Format

1. Add parser in `backend/ingest/csv_parsers.py`
2. Add example CSV in `examples/`

### Adding Frontend Component

1. Create in `frontend/components/`
2. Use Tailwind for styling
3. Follow existing patterns

## Docker Images

- API: `ghcr.io/raolivei/canopy-api:<tag>`
- Frontend: `ghcr.io/raolivei/canopy-frontend:<tag>`

## Key Design Decisions

- **Self-hosted only**: No cloud dependencies
- **Privacy-first**: All data stored locally
- **Multi-currency**: CAD, USD, BRL, EUR, GBP
- **Raspberry Pi optimized**: Low-power hardware
